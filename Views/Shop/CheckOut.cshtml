@{
    ViewData["Title"] = "Checkout";
}
@model List<it15_palit.Entity.Cart>

<h1>@ViewData["Title"]</h1>

@if (TempData["Message"] != null)
{
    <div class="toast align-items-center bg-blue border-0 position-fixed top-0 end-0" style="margin-top: 7rem;" role="alert" aria-live="assertive" aria-atomic="true" id="toast">
        <div class="d-flex">
            <div class="toast-body text-white">
                @TempData["Message"]
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
}

<div class="row bg-white p-2 mt-3 rounded">
    <div class="col">
        <div class="row">
            <i class="ri-map-pin-2-fill col-auto text-blue"></i>
            <div class="col mb-2">
                <span class="text-blue"><strong>Delivery Address:</strong></span>
            </div>
        </div>
        <div class="row">
            <div class="col-auto">
                <strong>@ViewBag.CustomerName</strong>
            </div>
            <div class="col-auto">
                @ViewBag.Address
            </div>
        </div>
    </div>
</div>

<div class="row bg-white p-2 mt-3 rounded">
    <div class="col-6 text-start">
        Products Ordered
    </div>
    <div class="col-2 text-end">
        Unit Price
    </div>
    <div class="col-2 text-end">
        Quantity
    </div>
    <div class="col-2 text-end">
        Item Subtotal
    </div>
    @foreach (var item in Model.Where(c => c.Is_Checked))
    {
        <div class="row py-2 mt-5 bg-white rounded">
            <div class="col-6 d-flex align-items-center text-start">
                <img src="~/@item.Product.Image_url" class="w-25" />
                <span class="ms-2">@item.Product.Name</span>
            </div>
            <div class="col-2 d-flex align-center">
                ₱@item.Product.Price
            </div>
            <div class="col-2 p-0 align-center">
                @item.Quantity
            </div>
            <div class="col-2 align-center text-end">
                ₱@(item.Product.Price * item.Quantity)
            </div>
        </div>
    }
</div>

<div class="row bg-white text-end py-3">
    <span>
        Order Total (@Model.Count(c => c.Is_Checked) items):
        <span class="text-blue">
            ₱@Model.Where(c => c.Is_Checked).Sum(item => item.Product.Price * item.Quantity)
        </span>
    </span>
</div>

<div class="row align-items-center bg-white mt-5 py-3">
    <div class="col-12 col-md-6 col-lg-5 d-flex align-items-center">
        <span>Payment Method</span>
    </div>
    <div class="col-12 col-md-6 col-lg-7 align-center justify-content-end">
        <div class="col-4">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="card">
                <label class="form-check-label" for="creditCard">Card</label>
            </div>
        </div>
        <div class="col-4">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="paymaya" value="paymaya">
                <label class="form-check-label" for="paymaya">PayMaya</label>
            </div>
        </div>
        <div class="col-4">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="paymentMethod" id="gcash" value="gcash">
                <label class="form-check-label" for="gcash">GCash</label>
            </div>
        </div>
    </div>
</div>

<div class="row bg-white">
    <div class="col-7"></div>
    <div class="col-5 mt-3">
        <div class="row align-center">
            <div class="col-12 col-md-6 col-lg-8">
                <span class="text-start">Merchandise Subtotal:</span>
            </div>
            <div class="col-12 col-md-6 col-lg-4 text-end">
                <span class="ms-5">₱@Model.Where(c => c.Is_Checked).Sum(item => item.Product.Price * item.Quantity)</span>
            </div>
        </div>
        <div class="row align-center mt-3">
            <div class="col-12 col-md-6 col-lg-8">
                <span class="text-start">Shipping Total:</span>
            </div>
            <div class="col-12 col-md-6 col-lg-4 text-end">
                <span class="ms-5">₱0.00</span>
            </div>
        </div>
        <div class="row align-center mt-3">
            <div class="col-12 col-md-6 col-lg-6">
                <span class="text-start">Total Payment:</span>
            </div>
            <div class="col-12 col-md-6 col-lg-6 text-end">
                <span class="ms-5 text-blue fs-2 fw-bold">₱@Model.Where(c => c.Is_Checked).Sum(item => item.Product.Price * item.Quantity)</span>
            </div>
        </div>
        <hr />
        <div class="d-flex justify-content-end mt-3">
            <form method="post" action="/Shop/CreatePayment">
                <input type="hidden" name="amount" value="@Model.Where(c => c.Is_Checked).Sum(item => item.Product.Price * item.Quantity)" />
                <input type="hidden" name="paymentMethod" id="selectedPaymentMethod" value="gcash" />
                <button type="submit" class="btn bg-blue text-white px-5 mb-3">
                    <span class="fs-5">Place Order</span>
                </button>
            </form>
        </div>
    </div>
</div>

<script>
          document.querySelector('form').addEventListener('submit', function (e) {
        const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');

        if (!selectedMethod) {
            e.preventDefault(); 
            alert("Please select a payment method.");
        } else {
            document.getElementById('selectedPaymentMethod').value = selectedMethod.value; 
        }
    });

    
    function updateSelectedPaymentMethod() {
        var selectedMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
        document.getElementById("selectedPaymentMethod").value = selectedMethod;
    }

    var radios = document.querySelectorAll('input[name="paymentMethod"]');
    radios.forEach(function (radio) {
        radio.addEventListener('change', updateSelectedPaymentMethod);
    });

    document.addEventListener('DOMContentLoaded', function () {
        updateSelectedPaymentMethod();
    });

</script>
